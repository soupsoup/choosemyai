{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h4 class="card-title mb-0">Customize Appearance</h4>
            </div>
            <div class="card-body">
                <form method="POST" id="appearanceForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="primary_color" class="form-label">Primary Color</label>
                                <div class="input-group">
                                    <input type="color" class="form-control form-control-color" 
                                           id="primary_color" name="primary_color" 
                                           value="{{ settings.primary_color }}" title="Choose primary color">
                                    <input type="text" class="form-control" 
                                           value="{{ settings.primary_color }}" 
                                           data-color-input="primary_color" readonly>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="secondary_color" class="form-label">Secondary Color</label>
                                <div class="input-group">
                                    <input type="color" class="form-control form-control-color" 
                                           id="secondary_color" name="secondary_color" 
                                           value="{{ settings.secondary_color }}" title="Choose secondary color">
                                    <input type="text" class="form-control" 
                                           value="{{ settings.secondary_color }}" 
                                           data-color-input="secondary_color" readonly>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="background_color" class="form-label">Background Color</label>
                                <div class="input-group">
                                    <input type="color" class="form-control form-control-color" 
                                           id="background_color" name="background_color" 
                                           value="{{ settings.background_color }}" title="Choose background color">
                                    <input type="text" class="form-control" 
                                           value="{{ settings.background_color }}" 
                                           data-color-input="background_color" readonly>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="font_color" class="form-label">Font Color</label>
                                <div class="input-group">
                                    <input type="color" class="form-control form-control-color" 
                                           id="font_color" name="font_color" 
                                           value="{{ settings.font_color }}" title="Choose font color">
                                    <input type="text" class="form-control" 
                                           value="{{ settings.font_color }}" 
                                           data-color-input="font_color" readonly>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="header_background" class="form-label">Header Background</label>
                                <div class="input-group">
                                    <input type="color" class="form-control form-control-color" 
                                           id="header_background" name="header_background" 
                                           value="{{ settings.header_background }}" title="Choose header background color">
                                    <input type="text" class="form-control" 
                                           value="{{ settings.header_background }}" 
                                           data-color-input="header_background" readonly>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="secondary_text_color" class="form-label">Secondary Text Color</label>
                                <div class="input-group">
                                    <input type="color" class="form-control form-control-color" 
                                           id="secondary_text_color" name="secondary_text_color" 
                                           value="{{ settings.secondary_text_color }}" title="Choose secondary text color">
                                    <input type="text" class="form-control" 
                                           value="{{ settings.secondary_text_color }}" 
                                           data-color-input="secondary_text_color" readonly>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="placeholder_text_color" class="form-label">Placeholder Text Color</label>
                                <div class="input-group">
                                    <input type="color" class="form-control form-control-color" 
                                           id="placeholder_text_color" name="placeholder_text_color" 
                                           value="{{ settings.placeholder_text_color }}" title="Choose placeholder text color">
                                    <input type="text" class="form-control" 
                                           value="{{ settings.placeholder_text_color }}" 
                                           data-color-input="placeholder_text_color" readonly>
                                </div>
                            </div>
                        </div>

                        <div class="col-12">
                            <div class="form-group">
                                <label for="font_family" class="form-label">Font Family</label>
                                <select class="form-select" id="font_family" name="font_family">
                                    <option value="system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', 'Noto Sans', 'Liberation Sans', Arial, sans-serif" 
                                            {% if settings.font_family == "system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', 'Noto Sans', 'Liberation Sans', Arial, sans-serif" %}selected{% endif %}>
                                        System Default
                                    </option>
                                    <option value="'Roboto', sans-serif" 
                                            {% if settings.font_family == "'Roboto', sans-serif" %}selected{% endif %}>
                                        Roboto
                                    </option>
                                    <option value="'Open Sans', sans-serif" 
                                            {% if settings.font_family == "'Open Sans', sans-serif" %}selected{% endif %}>
                                        Open Sans
                                    </option>
                                    <option value="'Lato', sans-serif" 
                                            {% if settings.font_family == "'Lato', sans-serif" %}selected{% endif %}>
                                        Lato
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                        <button type="reset" class="btn btn-secondary" id="resetButton">Reset</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('appearanceForm');
    const initialValues = {};
    
    // Store initial values for reset
    document.querySelectorAll('input[type="color"]').forEach(colorPicker => {
        initialValues[colorPicker.id] = colorPicker.value;
    });
    initialValues['font_family'] = document.getElementById('font_family').value;
    
    // Handle color picker changes
    document.querySelectorAll('input[type="color"]').forEach(colorPicker => {
        // Handle both input and change events
        ['input', 'change'].forEach(eventType => {
            colorPicker.addEventListener(eventType, function() {
                const textInput = document.querySelector(`input[data-color-input="${this.id}"]`);
                if (textInput) {
                    textInput.value = this.value.toUpperCase();
                }
            });
        });
    });

    // Handle form reset
    form.addEventListener('reset', function(e) {
        // Use setTimeout to ensure this runs after the default reset behavior
        setTimeout(() => {
            // Reset color pickers and their text inputs
            document.querySelectorAll('input[type="color"]').forEach(colorPicker => {
                colorPicker.value = initialValues[colorPicker.id];
                const textInput = document.querySelector(`input[data-color-input="${colorPicker.id}"]`);
                if (textInput) {
                    textInput.value = initialValues[colorPicker.id].toUpperCase();
                }
            });
            
            // Reset font family select
            document.getElementById('font_family').value = initialValues['font_family'];
        }, 0);
    });

    // Handle form submission
    form.addEventListener('submit', function(e) {
        const submitButton = form.querySelector('button[type="submit"]');
        submitButton.disabled = true;
        submitButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Saving...';
    });
});
</script>
{% endblock %}
